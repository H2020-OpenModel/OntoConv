version: 1
strategies:
# first material is Aluminium
- dataresource: load_data_al
  downloadUrl: file://tests/tests_dlite_plugins/testfiles/input/material_card_al.json
  mediaType: application/vnd.dlite-parse
  configuration:
    label: materialcard_al
    metadata: http://www.sintef.no/calm/0.1/AbaqusSimpleMaterialCard
    driver: "json"


# create the material card input file for Abaqus
- function: write_material_al
  functionType: application/vnd.dlite-generate
  configuration:
    driver: plugin_abaqus_material
    # the name of the file is as expected by the Abaqus input template
    location: Section_materials.inp
    # the option indicates that we want to write a new file and the header
    options: "mode=w"
    label: materialcard_al

# second material is Concrete
- configuration:
    label: materialcard_concrete
    metadata: http://www.sintef.no/calm/0.1/AbaqusSimpleMaterialCard
    driver: "json"
  dataresource: load_data_concrete
  downloadUrl: file://tests/tests_dlite_plugins/testfiles/input/material_card_concrete.json
  mediaType: application/vnd.dlite-parse

# create the material card input file for Abaqus
- function: write_material_concrete
  functionType: application/vnd.dlite-generate
  configuration:
    driver: plugin_abaqus_material
    # the name of the file is as expected by the Abaqus input template
    location: Section_materials.inp
    # the option indicates that we do not write the header
    options: "mode=a"
    label: materialcard_concrete


# create the AiiDA SingleFile nodes in two steps through a Dlite collection
# Step1 file stored in a dlite collection
- function: file2collection_mat
  functionType: aiidacuds/file2collection
  configuration:
    path: Section_materials.inp
    label: material_file

# Step 2 convert the file to an AiiDA node
# specific to execution with execflow
# the variable names defined in the declarative workflow should correspond to the label "material_file"
# from_cuds is not really a label you can't change it is a hard-coded thing
- function: cuds2datanode
  functionType: aiidacuds/cuds2datanode
  configuration:
    names: from_cuds

pipelines:
  pipe_abaqus_input: 'load_data_al | write_material_al | load_data_concrete | write_material_concrete'
  pipe_abaqus_input_aiida: 'load_data_al | write_material_al | load_data_concrete | write_material_concrete | file2collection_mat | cuds2datanode'
